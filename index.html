<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Great Indian Wave Menu</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- Favicon -->
  <link rel="icon" href="images/icon-192.png" type="image/png" />

  <meta name="theme-color" content="#d63384" />
  <style>
    body {
      background-color: #fff9f9;
      color: #212529;
      font-family: "Inter", sans-serif;
    }
    h1 {
      color: #d63384;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 30px;
    }
    .menu-section {
      margin-bottom: 40px;
    }
    .menu-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .menu-item:last-child {
      border-bottom: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>The Great Indian Wave Menu</h1>
    <div id="menu-container" class="text-center">
      <div class="spinner-border text-primary mt-5" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>

<script>
  // Load the menu
  fetch("menu.json")
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById("menu-container");
      container.innerHTML = "";

      Object.keys(data).forEach(category => {
        const section = document.createElement("div");
        section.innerHTML = `<h3 class="mt-4 text-primary border-bottom pb-2">${category}</h3><div class="row g-3"></div>`;
        const row = section.querySelector(".row");

        data[category].forEach(item => {
          const itemCard = document.createElement("div");
          itemCard.className = "col-md-4";
          itemCard.innerHTML = `
            <div class="card shadow-sm h-100 menu-item-card" style="cursor:pointer">
              <div class="card-body">
                <h5 class="card-title">${item.name}</h5>
                <p class="card-text">${item.price}</p>
              </div>
            </div>
          `;

          // Add modal trigger if nested options exist
          itemCard.querySelector(".card").addEventListener("click", () => {
            if (
              item.rice_selection ||
              item.salad_and_accompaniments ||
              item.desserts ||
              item.beverages
            ) {
              showOptionsModal(item);
            }
          });

          row.appendChild(itemCard);
        });

        container.appendChild(section);
      });
    })
    .catch(error => {
      console.error("Error loading menu:", error);
      document.getElementById("menu-container").innerHTML =
        "<p class='text-danger'>Failed to load menu. Please refresh or try again later.</p>";
    });

  // Show modal with pack options
  function showOptionsModal(item) {
    const modalBody = document.getElementById("modal-body");
    modalBody.innerHTML = "";

    const addSection = (title, items) => {
      if (!items) return;
      const section = document.createElement("div");
      section.innerHTML = `<h6 class="mt-3 text-primary">${title}</h6><ul class="list-unstyled"></ul>`;
      const list = section.querySelector("ul");
      items.forEach(opt => {
        const li = document.createElement("li");
        li.textContent = `${opt.name} - ${opt.price}`;
        list.appendChild(li);
      });
      modalBody.appendChild(section);
    };

    addSection("Rice Selection", item.rice_selection);
    addSection("Salad & Accompaniments", item.salad_and_accompaniments);
    addSection("Desserts", item.desserts);
    addSection("Beverages", item.beverages);

    document.getElementById("modal-title").textContent = item.name;
    const modal = new bootstrap.Modal(document.getElementById("optionsModal"));
    modal.show();
  }

  // Register service worker
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("service-worker.js")
        .then(reg => console.log("Service Worker registered:", reg.scope))
        .catch(err => console.error("Service Worker registration failed:", err));
    });
  }
</script>

<!-- Modal HTML -->
<div class="modal fade" id="optionsModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal-title">Pack Options</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>
</div>

</body>
</html>
