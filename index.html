<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }

  // Load menu.json
  fetch("menu.json")
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById("menu-container");

      Object.keys(data).forEach(category => {
        const section = document.createElement("div");
        section.innerHTML = `<h3 class="mt-4">${category}</h3><div class="row g-3"></div>`;
        const row = section.querySelector(".row");

        data[category].forEach(item => {
          // Check if item is a pack with nested sections
          const hasSubsections = item.rice_selection || item.salad_and_accompaniments || item.desserts || item.beverages;

          if (!hasSubsections) {
            // Regular menu item
            row.innerHTML += `
              <div class="col-md-4">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">${item.name}</h5>
                    <p class="card-text">${item.price}</p>
                  </div>
                </div>
              </div>
            `;
          } else {
            // Pack item
            row.innerHTML += `
              <div class="col-12">
                <div class="card shadow-sm mb-3">
                  <div class="card-body">
                    <h5 class="card-title">${item.name} - ${item.price}</h5>
                    
                    ${item.rice_selection ? `<h6>Rice Selection:</h6>
                      <ul>${item.rice_selection.map(r => `<li>${r.name} - ${r.price}</li>`).join('')}</ul>` : ''}

                    ${item.salad_and_accompaniments ? `<h6>Salad & Accompaniments:</h6>
                      <ul>${item.salad_and_accompaniments.map(s => `<li>${s.name} - ${s.price}</li>`).join('')}</ul>` : ''}

                    ${item.desserts ? `<h6>Desserts:</h6>
                      <ul>${item.desserts.map(d => `<li>${d.name} - ${d.price}</li>`).join('')}</ul>` : ''}

                    ${item.beverages ? `<h6>Beverages:</h6>
                      <ul>${item.beverages.map(b => `<li>${b.name} - ${b.price}</li>`).join('')}</ul>` : ''}
                  </div>
                </div>
              </div>
            `;
          }
        });

        container.appendChild(section);
      });
    });

  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("/service-worker.js")
        .then((reg) => console.log("Service worker registered:", reg.scope))
        .catch((err) => console.error("Service worker failed:", err));
    });
  }
</script>
